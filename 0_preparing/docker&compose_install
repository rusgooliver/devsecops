curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.io -y

sudo apt-get install docker-compose -y
docker --version
docker compose version

Это не просто "установка Docker", а безопасное добавление официального репозитория Docker в вашу систему и последующая установка из него.

Общая картина
Процесс состоит из четырех логических шагов:

Добавление ключа безопасности: Мы говорим нашей системе: "Доверять программному обеспечению, которое подписано этим ключом".
Добавление источника ПО (репозитория): Мы говорим системе: "Вот откуда можно скачивать это доверенное программное обеспечение".
Обновление списка пакетов: Мы заставляем систему посмотреть в новый источник и обновить свой каталог доступных программ.
Установка Docker: Мы устанавливаем саму программу из этого обновленного каталога.

Команда 1: Добавление GPG-ключа

curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
Эта команда делает две вещи, соединенные трубой |:

curl -fsSL https://download.docker.com/linux/ubuntu/gpg

curl: Утилита для скачивания данных из интернета.
-fsSL: Это набор флагов для "тихой" и надежной работы в скриптах:
-f (fail): Сразу завершить работу с ошибкой, если сервер вернул код ошибки (например, 404 Not Found).
-s (silent): Не показывать прогресс-бар загрузки.
-S (show-error): Если произошла ошибка (из-за флага -f), показать сообщение об этой ошибке.
-L (location): Если сервер перенаправил запрос на другой адрес, автоматически перейти по нему.
Что делает эта часть? Она скачивает GPG-ключ Docker. GPG-ключ — это цифровая подпись, которая подтверждает, что пакеты, которые вы скачиваете, действительно пришли от Docker и не были подменены злоумышленниками.
| sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

|: Это "труба" (pipe). Она передает результат работы команды слева (скачанный ключ) на вход команде справа.
sudo: Выполняет команду от имени суперпользователя (root), так как запись в системные папки требует повышенных прав.
gpg: Программа для работы с ключами шифрования.
--dearmor: Скачанный ключ находится в текстовом формате ("ASCII-armored"). Этот флаг преобразует его в бинарный формат, понятный менеджеру пакетов apt.
-o /usr/share/keyrings/docker-archive-keyring.gpg: Сохранить (output) полученный бинарный ключ в файл docker-archive-keyring.gpg в системной папке для ключей (/usr/share/keyrings/).
Итог команды 1: Мы скачали и безопасно сохранили официальный ключ Docker в доверенное хранилище ключей нашей системы.

Команда 2: Добавление репозитория Docker

echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
Эта команда создает файл с описанием репозитория.

echo "...": Выводит в консоль длинную строку. Давайте разберем ее содержимое:

deb: Стандартная метка для репозитория apt.
[arch=$(dpkg --print-architecture)]: Подставляет архитектуру вашей системы (например, amd64 или arm64). Это гарантирует, что вы скачаете правильную версию Docker.
[signed-by=...]: Это самая важная часть с точки зрения безопасности! Она явно указывает, что пакеты из этого репозитория должны быть проверены ключом, который мы сохранили на предыдущем шаге.
https://download.docker.com/linux/ubuntu: Адрес самого репозитория.
$(lsb_release -cs): Подставляет кодовое имя вашего дистрибутива Ubuntu (например, jammy для 22.04 или focal для 20.04). Это нужно, чтобы apt знал, для какой версии Ubuntu искать пакеты.
stable: Указывает на ветку стабильных релизов (а не тестовых или ночных).
| sudo tee /etc/apt/sources.list.d/docker.list:

sudo tee: Команда tee читает данные из входного потока и записывает их одновременно в файл и на экран. Мы используем sudo tee, потому что просто перенаправить вывод echo в системный файл (echo "..." > /etc/...) нельзя без прав root. sudo tee решает эту проблему.
/etc/apt/sources.list.d/docker.list: Путь к файлу, куда будет записана эта строка. apt автоматически читает все .list файлы из этой папки.
> /dev/null: Перенаправляет стандартный вывод команды tee (который дублирует строку на экран) в "никуда" (/dev/null). Это делается для чистоты, чтобы не засорять терминал.

Итог команды 2: Мы создали конфигурационный файл, который говорит apt, где найти официальные пакеты Docker и как их проверять на подлинность.

Команда 3: Обновление индекса пакетов

sudo apt update
sudo apt update: Эта команда заставляет менеджер пакетов apt перечитать все файлы репозиториев (включая наш новый docker.list), подключиться к указанным в них адресам и скачать свежие списки доступных пакетов.
Итог команды 3: Теперь ваша система "знает" о существовании пакетов docker-ce, docker-ce-cli и других из официального репозитория Docker.

Команда 4: Установка Docker

sudo apt install docker-ce docker-ce-cli containerd.io -y
sudo apt install: Команда для установки пакетов.
docker-ce: Docker Community Edition — сам основной движок Docker.
docker-ce-cli: Клиент Docker (команда docker), которой вы пользуетесь в терминале.
containerd.io: Низкоуровневый раннер для управления контейнерами, который использует Docker под капотом.
-y: Флаг, который автоматически отвечает "Да" на вопрос "Хотите продолжить? [Д/н]". Это удобно для автоматизации.
Итог команды 4: Устанавливаются все необходимые компоненты для работы Docker.

Почему такой сложный путь?
Просто выполнить sudo apt install docker.io было бы легче, но это установит версию Docker из стандартных репозиториев Ubuntu. Она часто бывает устаревшей.

Описанный выше метод гарантирует, что вы:

Устанавливаете самую последнюю версию Docker.
Устанавливаете её напрямую от разработчика (Docker Inc.).
Делаете это безопасно, проверяя цифровую подпись каждого пакета.
